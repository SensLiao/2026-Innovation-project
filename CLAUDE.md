# SOMA Project - Claude Code å®Œæ•´å¼€å‘æŒ‡å—

> **é˜…è¯»æœ¬æ–‡æ¡£åï¼Œä½ å°†å®Œå…¨ç†è§£é¡¹ç›®æ¶æ„ã€å¦‚ä½•éƒ¨ç½²ã€ä»¥åŠä¸‹ä¸€æ­¥è¯¥åšä»€ä¹ˆã€‚**

---

## ç›®å½•

1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [å¿«é€Ÿåˆå§‹åŒ– /init](#å¿«é€Ÿåˆå§‹åŒ–-init)
3. [Branch å·®å¼‚å¯¹æ¯”](#branch-å·®å¼‚å¯¹æ¯”)
4. [æ¨¡å‹é€‰æ‹©æ·±åº¦åˆ†æ](#æ¨¡å‹é€‰æ‹©æ·±åº¦åˆ†æ)
5. [å¤šæ¨¡å‹åŒæ—¶éƒ¨ç½²ç­–ç•¥](#å¤šæ¨¡å‹åŒæ—¶éƒ¨ç½²ç­–ç•¥)
6. [æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœ](#æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœ)
7. [TODO å¾…åŠæ¸…å•](#todo-å¾…åŠæ¸…å•)
8. [å¼€å‘å¯¹è¯è®°å½•](#å¼€å‘å¯¹è¯è®°å½•)
9. [å…³é”®æ–‡ä»¶è¯´æ˜](#å…³é”®æ–‡ä»¶è¯´æ˜)
10. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é¡¹ç›®æ¦‚è¿°

**SOMA Medical Report System** - USYD 2026 Coding Fest åŒ»å­¦å½±åƒå¤šæ™ºèƒ½ä½“æŠ¥å‘Šç”Ÿæˆç³»ç»Ÿ

### æ ¸å¿ƒåŠŸèƒ½
- åŒ»å­¦å½±åƒä¸Šä¼ ä¸ AI åˆ†å‰²
- å¤šæ™ºèƒ½ä½“åä½œåˆ†æ (Radiologist â†’ Pathologist â†’ ReportWriter â†’ QC)
- æ··åˆ LLM æ¶æ„ (æœ¬åœ° Ollama + äº‘ç«¯ Claude)
- å®æ—¶æµå¼æŠ¥å‘Šç”Ÿæˆ
- å¯¹è¯å¼æŠ¥å‘Šä¿®è®¢

### æŠ€æœ¯æ ˆ
- **Frontend**: React + Vite + TailwindCSS
- **Backend**: Node.js + Express + SSE
- **Database**: NeonDB (PostgreSQL)
- **LLM**: Ollama (Local) + Claude API (Cloud)
- **Hardware**: Mac Studio M4 Max, 36GB RAM

---

## å¿«é€Ÿåˆå§‹åŒ– /init

### ä¸€é”®éƒ¨ç½²è„šæœ¬

```bash
#!/bin/bash
# SOMA Hybrid LLM å¿«é€Ÿéƒ¨ç½²è„šæœ¬

echo "=== SOMA Hybrid LLM éƒ¨ç½² ==="

# 1. æ£€æŸ¥ Ollama
if ! command -v ollama &> /dev/null; then
    echo "å®‰è£… Ollama..."
    curl -fsSL https://ollama.com/install.sh | sh
fi

# 2. å¯åŠ¨ Ollama æœåŠ¡
echo "å¯åŠ¨ Ollama..."
ollama serve &
sleep 3

# 3. ä¸‹è½½æ¨¡å‹
echo "ä¸‹è½½æ¨¡å‹..."
ollama pull qwen3:32b   # ä¸»åŠ›æ¨¡å‹ (~20GB)
ollama pull qwen3:8b    # å¿«é€Ÿæ¨¡å‹ (~5GB)

# 4. éªŒè¯
echo "éªŒè¯æ¨¡å‹..."
ollama list

# 5. å…‹éš†é¡¹ç›®
echo "å…‹éš†é¡¹ç›®..."
git clone git@github.com:SensLiao/2026-Innovation-project.git
cd 2026-Innovation-project
git checkout feature/Steven-hybrid-local-llm

# 6. å®‰è£…ä¾èµ–
echo "å®‰è£…ä¾èµ–..."
cd backend && npm install
cd ../frontend && npm install

echo "=== éƒ¨ç½²å®Œæˆ ==="
echo "è¿è¡Œ: cd backend && npm run dev"
```

### æ‰‹åŠ¨æ­¥éª¤

#### Step 1: å®‰è£… Ollama
```bash
# macOS
brew install ollama

# æˆ–è€…å®˜æ–¹å®‰è£…è„šæœ¬
curl -fsSL https://ollama.com/install.sh | sh
```

#### Step 2: ä¸‹è½½æ¨¡å‹
```bash
# å¿…éœ€æ¨¡å‹
ollama pull qwen3:32b      # ä¸»åŠ›æ¨¡å‹ (å¤æ‚ä»»åŠ¡)
ollama pull qwen3:8b       # å¿«é€Ÿæ¨¡å‹ (ç®€å•ä»»åŠ¡)

# å¯é€‰ï¼šåŒ»å­¦ä¸“ç”¨æ¨¡å‹
ollama pull meditron:7b    # åŒ»å­¦é¢†åŸŸå¾®è°ƒ
ollama pull biomistral:7b  # ç”Ÿç‰©åŒ»å­¦

# éªŒè¯
ollama list
```

#### Step 3: é¡¹ç›®è®¾ç½®
```bash
git clone git@github.com:SensLiao/2026-Innovation-project.git
cd 2026-Innovation-project
git checkout feature/Steven-hybrid-local-llm

cd backend && npm install
cd ../frontend && npm install
```

#### Step 4: é…ç½®ç¯å¢ƒå˜é‡
```bash
# backend/.env
PORT=3000

# Database
PGUSER='neondb_owner'
PGPASSWORD='your_password'
PGHOST='your_host.neon.tech'
PGDATABASE='neondb'

JWT_SECRET='your_secret'

# ========================================
# LLM Provider Configuration (Hybrid)
# ========================================

# Ollama Local Model
OLLAMA_BASE_URL='http://localhost:11434'
OLLAMA_MODEL='qwen3:32b'

# Claude API (å¯é€‰ï¼Œç”¨äº ReportWriter)
ANTHROPIC_API_KEY='sk-ant-...'
CLAUDE_MODEL='claude-sonnet-4-20250514'

# æ¨¡å¼: 'local' | 'cloud' | 'hybrid'
LLM_MODE='hybrid'
```

#### Step 5: å¯åŠ¨æœåŠ¡
```bash
# Terminal 1: Ollama
ollama serve

# Terminal 2: Backend
cd backend && npm run dev

# Terminal 3: Frontend
cd frontend && npm run dev
```

#### Step 6: éªŒè¯å®‰è£…
```bash
# æµ‹è¯• Ollama
curl http://localhost:11434/api/tags

# æµ‹è¯• Backend
curl http://localhost:3000/health

# è¿è¡Œ Benchmark
cd backend && node tests/hybridBenchmark.js
```

---

## Branch å·®å¼‚å¯¹æ¯”

### `feature/Steven-hybrid-local-llm` vs `feature/Steven-multi-agent-system`

#### æ¶æ„å·®å¼‚

```
feature/Steven-multi-agent-system (Cloud Only)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   æ‰€æœ‰ Agent ç›´æ¥è°ƒç”¨ Claude API

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Radiologist â”‚â”€â”€â”€â”€â–¶â”‚             â”‚
   â”‚ Pathologist â”‚â”€â”€â”€â”€â–¶â”‚  Claude API â”‚
   â”‚ ReportWriterâ”‚â”€â”€â”€â”€â–¶â”‚   (Cloud)   â”‚
   â”‚ QCReviewer  â”‚â”€â”€â”€â”€â–¶â”‚             â”‚
   â”‚ Alignment   â”‚â”€â”€â”€â”€â–¶â”‚             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   ä¼˜ç‚¹: ç®€å•ã€è´¨é‡æœ€é«˜
   ç¼ºç‚¹: æˆæœ¬é«˜ã€éšç§é£é™©ã€ä¾èµ–ç½‘ç»œ


feature/Steven-hybrid-local-llm (Hybrid)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Provider æŠ½è±¡å±‚ + æ™ºèƒ½è·¯ç”±

   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Radiologist â”‚â”€â”€â”€â”€â–¶â”‚                 â”‚â”€â”€â”€â”€â–¶â”‚   Ollama    â”‚
   â”‚ Pathologist â”‚â”€â”€â”€â”€â–¶â”‚  Provider Layer â”‚     â”‚   (Local)   â”‚
   â”‚ QCReviewer  â”‚â”€â”€â”€â”€â–¶â”‚  + Smart Router â”‚     â”‚  qwen3:32b  â”‚
   â”‚ Alignment   â”‚â”€â”€â”€â”€â–¶â”‚                 â”‚     â”‚  qwen3:8b   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚                 â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚ Fallbackâ”‚   â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ReportWriterâ”‚â”€â”€â”€â”€â–¶â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”€â”€â”€â”€â–¶â”‚  Claude API â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   (Cloud)   â”‚
                                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   ä¼˜ç‚¹: éšç§ä¿æŠ¤ã€æˆæœ¬ä½ã€å¯ç¦»çº¿
   ç¼ºç‚¹: éœ€è¦ç®¡ç†å¤š Providerã€æœ¬åœ°ç¡¬ä»¶è¦æ±‚
```

#### æ–‡ä»¶å·®å¼‚

| ç±»å‹ | æ–‡ä»¶ | è¯´æ˜ | è¡Œæ•° |
|------|------|------|------|
| **æ–‡æ¡£** | | | |
| A | `CLAUDE.md` | å®Œæ•´éƒ¨ç½²æŒ‡å— | +322 |
| A | `HYBRID_LLM_PLAN.md` | æ¶æ„è®¾è®¡æ–‡æ¡£ | +336 |
| **Provider å±‚** | | | |
| A | `backend/providers/baseProvider.js` | æŠ½è±¡åŸºç±» | +83 |
| A | `backend/providers/ollamaProvider.js` | Ollama é›†æˆ | +286 |
| A | `backend/providers/claudeProvider.js` | Claude å°è£… | +169 |
| A | `backend/providers/index.js` | å·¥å‚ + è·¯ç”± | +223 |
| **Agent å±‚** | | | |
| A | `backend/agents/baseAgentHybrid.js` | å¤š Provider åŸºç±» | +235 |
| A | `backend/agents/radiologistAgentHybrid.js` | Hybrid ç¤ºä¾‹ | +291 |
| **é…ç½®** | | | |
| A | `backend/config/llm.config.js` | è·¯ç”±é…ç½® | +101 |
| M | `backend/.env` | æ·»åŠ  Ollama é…ç½® | +19 |
| **æµ‹è¯•** | | | |
| A | `backend/tests/hybridBenchmark.js` | Benchmark å¥—ä»¶ | +794 |
| A | `backend/tests/testOllamaProvider.js` | å•å…ƒæµ‹è¯• | +178 |
| A | `backend/tests/BENCHMARK_RESULTS.md` | æµ‹è¯•ç»“æœ | +226 |

**æ€»è®¡**: +3,265 è¡Œä»£ç ï¼Œ14 ä¸ªæ–‡ä»¶å˜åŠ¨

#### åŠŸèƒ½å¯¹æ¯”

| ç‰¹æ€§ | multi-agent-system | hybrid-local-llm |
|------|:------------------:|:----------------:|
| éšç§ä¿æŠ¤ | âŒ æ•°æ®å‘äº‘ç«¯ | âœ… æœ¬åœ°å¤„ç† |
| æˆæœ¬ | $0.08/æ¬¡ | $0.02/æ¬¡ |
| ç¦»çº¿è¿è¡Œ | âŒ | âœ… |
| å»¶è¿Ÿ (ç®€å•ä»»åŠ¡) | 1-3s | 3-5s |
| å»¶è¿Ÿ (å¤æ‚ä»»åŠ¡) | 10-20s | 20-50s |
| è´¨é‡ | â­â­â­â­â­ | â­â­â­â­ |
| éƒ¨ç½²å¤æ‚åº¦ | ç®€å• | ä¸­ç­‰ |
| ç¡¬ä»¶è¦æ±‚ | æ—  | Mac Studio |

---

## æ¨¡å‹é€‰æ‹©æ·±åº¦åˆ†æ

### å¯ç”¨æ¨¡å‹è¯„ä¼°

#### Qwen3 ç³»åˆ— (æ¨è)

| æ¨¡å‹ | å‚æ•° | VRAM | é€Ÿåº¦ | è´¨é‡ | é€‚ç”¨ä»»åŠ¡ |
|------|------|------|------|------|----------|
| `qwen3:0.6b` | 0.6B | 1GB | âš¡âš¡âš¡âš¡âš¡ | â­â­ | ä¸æ¨è |
| `qwen3:1.7b` | 1.7B | 2GB | âš¡âš¡âš¡âš¡ | â­â­â­ | ç®€å•åˆ†ç±» |
| `qwen3:4b` | 4B | 3GB | âš¡âš¡âš¡âš¡ | â­â­â­ | Intent, QC |
| `qwen3:8b` | 8B | 5GB | âš¡âš¡âš¡ | â­â­â­â­ | Intent, QC, ç®€å•åˆ†æ |
| `qwen3:14b` | 14B | 10GB | âš¡âš¡ | â­â­â­â­ | ä¸­ç­‰å¤æ‚åº¦ |
| `qwen3:32b` | 32B | 20GB | âš¡ | â­â­â­â­â­ | å¤æ‚åˆ†æã€è¯Šæ–­ |

#### Llama 3.2 ç³»åˆ—

| æ¨¡å‹ | å‚æ•° | VRAM | ç‰¹ç‚¹ |
|------|------|------|------|
| `llama3.2:1b` | 1B | 1GB | æå¿«ï¼Œè´¨é‡ä¸€èˆ¬ |
| `llama3.2:3b` | 3B | 2GB | å¿«é€Ÿï¼Œé€‚åˆç®€å•ä»»åŠ¡ |
| `llama3.2-vision:11b` | 11B | 8GB | **æ”¯æŒå›¾åƒè¾“å…¥** |
| `llama3.2:90b` | 90B | 50GB+ | è´¨é‡æœ€é«˜ï¼Œå¤ªå¤§ |

#### åŒ»å­¦ä¸“ç”¨æ¨¡å‹

| æ¨¡å‹ | è¯´æ˜ | æ¨èåº¦ |
|------|------|--------|
| `meditron:7b` | åŒ»å­¦é¢†åŸŸå¾®è°ƒ | â­â­â­ |
| `biomistral:7b` | ç”Ÿç‰©åŒ»å­¦ | â­â­â­ |
| `medllama2:7b` | åŒ»å­¦é—®ç­” | â­â­ |

### æ¨èé…ç½® (Mac Studio M4 Max 36GB)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æœ€ä½³æ¨¡å‹é…ç½® (36GB RAM)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  ä¸»åŠ›æ¨¡å‹: qwen3:32b                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ VRAM: ~20GB                                     â”‚   â”‚
â”‚  â”‚  â”œâ”€ ç”¨é€”: Radiologist, Pathologist, ReportWriter    â”‚   â”‚
â”‚  â”‚  â””â”€ è´¨é‡: â­â­â­â­â­                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¿«é€Ÿæ¨¡å‹: qwen3:8b                                  â”‚   â”‚
â”‚  â”‚  â”œâ”€ VRAM: ~5GB                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ ç”¨é€”: AlignmentAgent, QCReviewer                â”‚   â”‚
â”‚  â”‚  â””â”€ é€Ÿåº¦: 3-5s (æ¯” 32b å¿« 4x)                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¯é€‰: llama3.2-vision:11b                          â”‚   â”‚
â”‚  â”‚  â”œâ”€ VRAM: ~8GB                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ ç”¨é€”: çœŸæ­£çš„å›¾åƒåˆ†æ (RadiologistAgent)          â”‚   â”‚
â”‚  â”‚  â””â”€ ç‰¹ç‚¹: æ”¯æŒå›¾åƒè¾“å…¥                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  æ€» VRAM ä½¿ç”¨: 20 + 5 = 25GB (è¿˜æœ‰ 11GB ä½™é‡)              â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨¡å‹é€‰æ‹©å†³ç­–æ ‘

```
ä»»åŠ¡ç±»å‹æ˜¯ä»€ä¹ˆï¼Ÿ
â”‚
â”œâ”€ æ„å›¾åˆ†ç±» (AlignmentAgent)
â”‚   â””â”€ qwen3:8b (å¿«é€Ÿï¼Œ3-5s)
â”‚
â”œâ”€ è´¨é‡æ£€æŸ¥ (QCReviewer)
â”‚   â””â”€ qwen3:8b (ç®€å•æ ¡éªŒ)
â”‚
â”œâ”€ å›¾åƒåˆ†æ (RadiologistAgent)
â”‚   â”œâ”€ éœ€è¦çœŸå®å›¾åƒç†è§£ï¼Ÿ
â”‚   â”‚   â””â”€ llama3.2-vision:11b
â”‚   â””â”€ ä»…éœ€æ–‡æœ¬æè¿°åˆ†æï¼Ÿ
â”‚       â””â”€ qwen3:32b
â”‚
â”œâ”€ è¯Šæ–­åˆ†æ (PathologistAgent)
â”‚   â””â”€ qwen3:32b (éœ€è¦æ·±åº¦æ¨ç†)
â”‚
â””â”€ æŠ¥å‘Šç”Ÿæˆ (ReportWriterAgent)
    â”œâ”€ éœ€è¦æœ€é«˜è´¨é‡ï¼Ÿ
    â”‚   â””â”€ Claude API (äº‘ç«¯)
    â””â”€ å¯æ¥å—ç¨ä½è´¨é‡ï¼Ÿ
        â””â”€ qwen3:32b (æœ¬åœ°)
```

---

## å¤šæ¨¡å‹åŒæ—¶éƒ¨ç½²ç­–ç•¥

### Ollama å¤šæ¨¡å‹å¹¶è¡Œ

**å…³é”®å‘ç°**: Ollama å¯ä»¥åŒæ—¶åŠ è½½å¤šä¸ªæ¨¡å‹ï¼Œä½†ä¼šå ç”¨æ›´å¤šå†…å­˜

#### å†…å­˜ç®¡ç†

```bash
# æŸ¥çœ‹å½“å‰åŠ è½½çš„æ¨¡å‹
curl http://localhost:11434/api/ps

# é¢„åŠ è½½æ¨¡å‹åˆ°å†…å­˜
curl http://localhost:11434/api/generate \
  -d '{"model": "qwen3:8b", "keep_alive": "24h"}'

curl http://localhost:11434/api/generate \
  -d '{"model": "qwen3:32b", "keep_alive": "24h"}'
```

#### å¤šæ¨¡å‹é…ç½®

```javascript
// backend/config/llm.config.js
export const LLMConfig = {
  providers: {
    ollama: {
      enabled: true,
      baseUrl: 'http://localhost:11434',
      models: {
        fast: 'qwen3:8b',      // å¿«é€Ÿä»»åŠ¡
        balanced: 'qwen3:32b', // å¤æ‚ä»»åŠ¡
        vision: 'llama3.2-vision:11b' // å›¾åƒä»»åŠ¡
      }
    }
  },

  routing: {
    alignment: { model: 'fast' },      // qwen3:8b
    qcReviewer: { model: 'fast' },     // qwen3:8b
    radiologist: { model: 'vision' },  // llama3.2-vision
    pathologist: { model: 'balanced' }, // qwen3:32b
    reportWriter: { model: 'balanced' } // qwen3:32b
  }
};
```

### ä¼˜ç‚¹ vs ç¼ºç‚¹

#### ä¼˜ç‚¹

1. **ä»»åŠ¡ä¼˜åŒ–**: ä¸åŒä»»åŠ¡ç”¨æœ€åˆé€‚çš„æ¨¡å‹
2. **é€Ÿåº¦æå‡**: ç®€å•ä»»åŠ¡ç”¨å°æ¨¡å‹ï¼Œå¿« 4-5x
3. **èµ„æºåˆ©ç”¨**: 36GB å†…å­˜å¯åŒæ—¶è·‘å¤šä¸ªæ¨¡å‹
4. **çµæ´»æ€§**: å¯éšæ—¶åˆ‡æ¢æ¨¡å‹

#### ç¼ºç‚¹

1. **å†…å­˜å‹åŠ›**: åŒæ—¶åŠ è½½å¤šæ¨¡å‹å ç”¨æ›´å¤š RAM
2. **å†·å¯åŠ¨**: é¦–æ¬¡åŠ è½½æ¨¡å‹éœ€è¦æ—¶é—´ (~10-30s)
3. **å¤æ‚æ€§**: éœ€è¦ç®¡ç†æ¨¡å‹è·¯ç”±é€»è¾‘
4. **ä¸€è‡´æ€§**: ä¸åŒæ¨¡å‹è¾“å‡ºé£æ ¼å¯èƒ½ä¸åŒ

### å†…å­˜è§„åˆ’ (36GB)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    å†…å­˜åˆ†é…è§„åˆ’                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ç³»ç»Ÿ + åº”ç”¨: 6GB                                           â”‚
â”‚  â”œâ”€ macOS: 4GB                                             â”‚
â”‚  â””â”€ Node.js + Browser: 2GB                                  â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                                                             â”‚
â”‚  æ–¹æ¡ˆ A: å•æ¨¡å‹ (ç®€å•)                                       â”‚
â”‚  â””â”€ qwen3:32b: 20GB                                         â”‚
â”‚  â””â”€ å‰©ä½™: 10GB                                              â”‚
â”‚                                                             â”‚
â”‚  æ–¹æ¡ˆ B: åŒæ¨¡å‹ (æ¨è)                                       â”‚
â”‚  â”œâ”€ qwen3:32b: 20GB                                         â”‚
â”‚  â””â”€ qwen3:8b: 5GB                                           â”‚
â”‚  â””â”€ å‰©ä½™: 5GB                                               â”‚
â”‚                                                             â”‚
â”‚  æ–¹æ¡ˆ C: ä¸‰æ¨¡å‹ (æ¿€è¿›)                                       â”‚
â”‚  â”œâ”€ qwen3:32b: 20GB                                         â”‚
â”‚  â”œâ”€ qwen3:8b: 5GB                                           â”‚
â”‚  â””â”€ llama3.2-vision:11b: 8GB                                â”‚
â”‚  â””â”€ å‰©ä½™: -3GB âš ï¸ (ä¼šç”¨ swapï¼Œå˜æ…¢)                          â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¨èç­–ç•¥

```
ç”Ÿäº§ç¯å¢ƒæ¨è: æ–¹æ¡ˆ B (åŒæ¨¡å‹)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

qwen3:32b (ä¸»åŠ›)
â”œâ”€ RadiologistAgent
â”œâ”€ PathologistAgent
â””â”€ ReportWriterAgent

qwen3:8b (å¿«é€Ÿ)
â”œâ”€ AlignmentAgent
â””â”€ QCReviewerAgent

åŸå› :
1. å†…å­˜å®‰å…¨ï¼Œç•™æœ‰ä½™é‡
2. è¦†ç›–æ‰€æœ‰ä»»åŠ¡ç±»å‹
3. ç®€å•ä»»åŠ¡é€Ÿåº¦æå‡ 4x
4. å¤æ‚ä»»åŠ¡ä¿è¯è´¨é‡
```

---

## æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœ

**æµ‹è¯•ç¯å¢ƒ**: Mac Studio M4 Max, 36GB RAM, Qwen3 32B

### å•ä»»åŠ¡å»¶è¿Ÿ

| Agent | å»¶è¿Ÿ | Tokens | è´¨é‡ | Provider |
|-------|------|--------|------|----------|
| Intent Classification | 12.4s | 247 | âœ… | Local |
| Radiologist Analysis | 19.6s | ~350 | âœ… ä¸“ä¸š | Local |
| Pathologist Diagnosis | 49.6s | 800 | âœ… è¯¦ç»† | Local |
| Report Writer | 28.3s | 451 | âœ… é«˜è´¨é‡ | Local |
| QC Reviewer | 14.5s | 229 | âœ… | Local |

### Pipeline å¯¹æ¯”

```
Sequential (å½“å‰):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Alignment    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 12.4s
Radiologist  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 24.6s
Pathologist  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 24.9s
ReportWriter â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 21.7s
QCReviewer   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 12.5s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total: 96.2s (~1.6 min)


Optimized (å¹¶è¡Œ):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Alignment    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 12s
             â”œâ”€ Radiologist â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 25s â”€â”
             â””â”€ Pathologist â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 25s â”€â”¤ max: 25s
ReportWriter â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 22s                    â”‚
QCReviewer   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 12s                              â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total: ~71s (26% faster)


With qwen3:8b for simple tasks:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Alignment    â–ˆâ–ˆâ–ˆ 3s (qwen3:8b)
             â”œâ”€ Radiologist â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 25s â”€â”
             â””â”€ Pathologist â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 25s â”€â”¤
ReportWriter â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 22s                    â”‚
QCReviewer   â–ˆâ–ˆâ–ˆ 3s (qwen3:8b)                             â”‚
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Total: ~53s (45% faster!)
```

### æˆæœ¬å¯¹æ¯”

| æ–¹æ¡ˆ | å•æ¬¡ | 1000æ¬¡/æœˆ | å¹´æˆæœ¬ | ç¡¬ä»¶ |
|------|------|-----------|--------|------|
| Cloud Only | $0.08 | $80 | $960 | æ—  |
| Hybrid | $0.02 | $20 | $240 | Mac Studio |
| Full Local | $0.002 | $2 | $24 | Mac Studio |

**ROI è®¡ç®—**: Mac Studio ($4000) åœ¨ 1000æ¬¡/æœˆ ä½¿ç”¨é‡ä¸‹ï¼Œç›¸æ¯” Cloud Only çº¦ 5 ä¸ªæœˆå›æœ¬

---

## TODO å¾…åŠæ¸…å•

### é«˜ä¼˜å…ˆçº§ ğŸ”´

- [ ] **å®ç°å¤šæ¨¡å‹å¹¶è¡ŒåŠ è½½**
  - ä¿®æ”¹ `ollamaProvider.js` æ”¯æŒåŠ¨æ€æ¨¡å‹é€‰æ‹©
  - åœ¨ `llm.config.js` ä¸­æ·»åŠ æ¨¡å‹è·¯ç”±è§„åˆ™
  - é¢„åŠ è½½å¸¸ç”¨æ¨¡å‹åˆ°å†…å­˜

- [ ] **å®ç° Pipeline å¹¶è¡Œæ‰§è¡Œ**
  - ä¿®æ”¹ Orchestrator æ”¯æŒ Radiologist + Pathologist å¹¶è¡Œ
  - é¢„è®¡æå‡ 25-30% é€Ÿåº¦

- [ ] **ä¸‹è½½ qwen3:8b ç”¨äºå¿«é€Ÿä»»åŠ¡**
  ```bash
  ollama pull qwen3:8b
  ```

- [ ] **æ›´æ–°ç°æœ‰ Agents ä½¿ç”¨ Hybrid åŸºç±»**
  - PathologistAgent â†’ PathologistAgentHybrid
  - ReportWriterAgent â†’ ReportWriterAgentHybrid
  - QCReviewerAgent â†’ QCReviewerAgentHybrid
  - AlignmentAgent â†’ AlignmentAgentHybrid

### ä¸­ä¼˜å…ˆçº§ ğŸŸ¡

- [ ] **æ·»åŠ  Vision æ¨¡å‹æ”¯æŒ**
  ```bash
  ollama pull llama3.2-vision:11b
  ```
  - è®© RadiologistAgent çœŸæ­£"çœ‹"å›¾åƒ

- [ ] **å®ç° Provider å¥åº·æ£€æŸ¥**
  - è‡ªåŠ¨æ£€æµ‹ Ollama æœåŠ¡çŠ¶æ€
  - å¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ° Claude fallback

- [ ] **æ·»åŠ æ€§èƒ½ç›‘æ§ Dashboard**
  - è®°å½•æ¯æ¬¡è°ƒç”¨çš„å»¶è¿Ÿã€tokensã€provider
  - å¯è§†åŒ–å±•ç¤º

- [ ] **åˆ›å»º A/B æµ‹è¯•æ¡†æ¶**
  - å¯¹æ¯” Local vs Cloud è¾“å‡ºè´¨é‡
  - æ”¶é›†ç”¨æˆ·åé¦ˆ

### ä½ä¼˜å…ˆçº§ ğŸŸ¢

- [ ] **æ¢ç´¢ MLX æ¡†æ¶**
  - Apple Silicon åŸç”Ÿä¼˜åŒ–
  - å¯èƒ½æ¯” Ollama æ›´å¿«

- [ ] **æ·»åŠ æ¨¡å‹ç¼“å­˜é¢„çƒ­è„šæœ¬**
  - å¼€æœºè‡ªåŠ¨åŠ è½½å¸¸ç”¨æ¨¡å‹
  - å‡å°‘é¦–æ¬¡è°ƒç”¨å»¶è¿Ÿ

- [ ] **æ–‡æ¡£ï¼šæ·»åŠ è§†é¢‘æ•™ç¨‹**
  - å½•åˆ¶éƒ¨ç½²æµç¨‹
  - å½•åˆ¶ä½¿ç”¨æ¼”ç¤º

- [ ] **æ¢ç´¢é‡åŒ–é€‰é¡¹**
  - Q4_K_M vs Q5_K_M vs Q8
  - æ‰¾åˆ°è´¨é‡/é€Ÿåº¦æœ€ä½³å¹³è¡¡ç‚¹

---

## å¼€å‘å¯¹è¯è®°å½•

### 2025-11-29 Session Summary

**å‚ä¸è€…**: Steven (ç”¨æˆ·) + Claude Code (AI)

#### ä¸»è¦å·¥ä½œ

1. **åˆ›å»º Hybrid LLM Branch**
   - ä» `feature/Steven-multi-agent-system` åˆ›å»ºæ–°åˆ†æ”¯
   - åˆ†æ”¯å: `feature/Steven-hybrid-local-llm`

2. **å®ç° Provider æŠ½è±¡å±‚**
   - åˆ›å»º `baseProvider.js` - æŠ½è±¡åŸºç±»
   - åˆ›å»º `ollamaProvider.js` - Ollama æœ¬åœ°æ¨¡å‹é›†æˆ
   - åˆ›å»º `claudeProvider.js` - Claude API å°è£…
   - åˆ›å»º `index.js` - Provider å·¥å‚ + æ™ºèƒ½è·¯ç”±

3. **Qwen3 Thinking Mode å‘ç°**
   - é—®é¢˜: Qwen3 é»˜è®¤è¾“å‡º ~200-300 tokens çš„å†…éƒ¨æ¨ç†
   - è§£å†³: åœ¨ `ollamaProvider.js` ä¸­æ·»åŠ  `thinkingBudget` è¡¥å¿
   ```javascript
   const adjustedMaxTokens = maxTokens + this.defaultOptions.thinkingBudget;
   ```

4. **å®Œæ•´ Benchmark æµ‹è¯•**
   - æµ‹è¯•äº†æ‰€æœ‰ 5 ä¸ª Agent
   - è®°å½•å»¶è¿Ÿã€token ä½¿ç”¨ã€è¾“å‡ºè´¨é‡
   - å®Œæ•´ Pipeline: 96.2s

5. **æ¨¡å‹æ¨è**
   - ä¸»åŠ›: `qwen3:32b` (å¤æ‚ä»»åŠ¡)
   - å¿«é€Ÿ: `qwen3:8b` (ç®€å•ä»»åŠ¡)
   - è·¯ç”±: 80% Local, 20% Cloud (ReportWriter)

6. **SSH Key é…ç½®**
   - ç”Ÿæˆ ed25519 key
   - æ·»åŠ åˆ° GitHub
   - æˆåŠŸ push åˆ° remote

#### å…³é”®å‘½ä»¤è®°å½•

```bash
# ä¸‹è½½æ¨¡å‹
ollama pull qwen3:32b
ollama pull qwen3:8b

# åˆ›å»ºåˆ†æ”¯
git checkout -b feature/Steven-hybrid-local-llm

# Push
git push -u origin feature/Steven-hybrid-local-llm

# SSH é…ç½®
ssh-keygen -t ed25519 -C "clyu0742@uni.sydney.edu.au"
ssh-add ~/.ssh/id_ed25519
```

#### é‡åˆ°çš„é—®é¢˜ & è§£å†³

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| `node: command not found` | ä½¿ç”¨ `curl` ç›´æ¥æµ‹è¯• Ollama API |
| Qwen3 `/no_think` æ— æ•ˆ | å¢åŠ  token é¢„ç®—è¡¥å¿ thinking |
| å“åº”å†…å®¹è¢«æˆªæ–­ | æé«˜ `num_predict` åˆ° 512+ |
| Host key verification failed | `ssh-keyscan github.com >> ~/.ssh/known_hosts` |
| CLAUDE.md è¢« gitignore | ä» `.gitignore` ç§»é™¤è¯¥æ–‡ä»¶ |

---

## å…³é”®æ–‡ä»¶è¯´æ˜

### Provider Layer

```
backend/providers/
â”œâ”€â”€ baseProvider.js       # æŠ½è±¡åŸºç±»ï¼Œå®šä¹‰æ¥å£
â”‚   â”œâ”€â”€ complete()        # éæµå¼è°ƒç”¨
â”‚   â”œâ”€â”€ stream()          # æµå¼è°ƒç”¨
â”‚   â””â”€â”€ isAvailable()     # å¥åº·æ£€æŸ¥
â”‚
â”œâ”€â”€ ollamaProvider.js     # Ollama æœ¬åœ°æ¨¡å‹
â”‚   â”œâ”€â”€ formatMessages()  # æ¶ˆæ¯æ ¼å¼åŒ–
â”‚   â”œâ”€â”€ generate()        # ç®€å•æ–‡æœ¬ç”Ÿæˆ
â”‚   â””â”€â”€ thinkingBudget    # Qwen3 æ€è€ƒæ¨¡å¼è¡¥å¿
â”‚
â”œâ”€â”€ claudeProvider.js     # Claude API å°è£…
â”‚   â””â”€â”€ ä¿æŒåŸæœ‰ Claude åŠŸèƒ½
â”‚
â””â”€â”€ index.js              # Provider ç®¡ç†å™¨
    â”œâ”€â”€ ProviderManager   # å·¥å‚ç±»
    â”œâ”€â”€ getProvider()     # è·å– Provider å®ä¾‹
    â”œâ”€â”€ TaskType          # ä»»åŠ¡ç±»å‹æšä¸¾
    â””â”€â”€ DEFAULT_ROUTING   # é»˜è®¤è·¯ç”±è§„åˆ™
```

### Agent Layer

```
backend/agents/
â”œâ”€â”€ baseAgent.js              # åŸå§‹åŸºç±» (Cloud Only)
â”œâ”€â”€ baseAgentHybrid.js        # Hybrid åŸºç±»
â”‚   â”œâ”€â”€ selectProvider()      # Provider é€‰æ‹©é€»è¾‘
â”‚   â””â”€â”€ executeWithFallback() # å¸¦ fallback çš„æ‰§è¡Œ
â”‚
â”œâ”€â”€ radiologistAgent.js       # åŸå§‹å®ç°
â””â”€â”€ radiologistAgentHybrid.js # Hybrid ç‰ˆæœ¬
    â”œâ”€â”€ analyzeWithLocal()    # æœ¬åœ°æ¨¡å‹åˆ†æ
    â””â”€â”€ analyzeWithCloud()    # äº‘ç«¯æ¨¡å‹åˆ†æ
```

### Configuration

```
backend/config/
â””â”€â”€ llm.config.js
    â”œâ”€â”€ providers{}           # Provider é…ç½®
    â”‚   â”œâ”€â”€ ollama{}          # Ollama è®¾ç½®
    â”‚   â””â”€â”€ claude{}          # Claude è®¾ç½®
    â”‚
    â”œâ”€â”€ routing{}             # Agent â†’ Provider æ˜ å°„
    â”‚   â”œâ”€â”€ radiologist       # { primary: 'ollama', fallback: 'claude' }
    â”‚   â”œâ”€â”€ pathologist       # { primary: 'ollama', fallback: 'claude' }
    â”‚   â”œâ”€â”€ reportWriter      # { primary: 'claude', fallback: 'ollama' }
    â”‚   â””â”€â”€ qcReviewer        # { primary: 'ollama', fallback: null }
    â”‚
    â””â”€â”€ fallback{}            # Fallback é…ç½®
        â”œâ”€â”€ enabled           # æ˜¯å¦å¯ç”¨
        â””â”€â”€ maxRetries        # æœ€å¤§é‡è¯•æ¬¡æ•°
```

---

## å¸¸è§é—®é¢˜

### Q: Mac Studio é‡å¯åæ€ä¹ˆæ¢å¤ï¼Ÿ

```bash
# 1. å¯åŠ¨ Ollama
ollama serve

# 2. éªŒè¯æ¨¡å‹
ollama list

# 3. å¦‚æœæ¨¡å‹ä¸¢å¤±ï¼Œé‡æ–°ä¸‹è½½
ollama pull qwen3:32b
ollama pull qwen3:8b

# 4. å¯åŠ¨é¡¹ç›®
cd 2026-Innovation-project/backend && npm run dev
```

### Q: å¦‚ä½•åˆ‡æ¢å› Cloud Only æ¨¡å¼ï¼Ÿ

```bash
# ä¿®æ”¹ backend/.env
LLM_MODE='cloud'

# æˆ–è€…åœ¨ä»£ç ä¸­
process.env.LLM_MODE = 'cloud';
```

### Q: Ollama å¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

1. ä½¿ç”¨æ›´å°çš„æ¨¡å‹: `qwen3:8b` ä»£æ›¿ `qwen3:32b`
2. å‡å°‘ `num_ctx`: 4096 â†’ 2048
3. é™ä½ `temperature`: 0.7 â†’ 0.3
4. å…³é—­å…¶ä»–å ç”¨ GPU çš„åº”ç”¨

### Q: å†…å­˜ä¸è¶³æ€ä¹ˆåŠï¼Ÿ

```bash
# æ£€æŸ¥å½“å‰åŠ è½½çš„æ¨¡å‹
curl http://localhost:11434/api/ps

# å¸è½½ä¸éœ€è¦çš„æ¨¡å‹
curl http://localhost:11434/api/generate \
  -d '{"model": "qwen3:32b", "keep_alive": "0"}'
```

### Q: å¦‚ä½•æ·»åŠ æ–°çš„ Providerï¼Ÿ

1. åˆ›å»º `backend/providers/newProvider.js`
2. ç»§æ‰¿ `BaseProvider`
3. å®ç° `complete()`, `stream()`, `isAvailable()`
4. åœ¨ `index.js` ä¸­æ³¨å†Œ
5. åœ¨ `llm.config.js` ä¸­æ·»åŠ è·¯ç”±

---

## å¿«é€Ÿå‚è€ƒå¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SOMA å¿«é€Ÿå‚è€ƒ                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  å¯åŠ¨æœåŠ¡:                                                  â”‚
â”‚  $ ollama serve                                             â”‚
â”‚  $ cd backend && npm run dev                                â”‚
â”‚  $ cd frontend && npm run dev                               â”‚
â”‚                                                             â”‚
â”‚  æµ‹è¯• Ollama:                                               â”‚
â”‚  $ curl http://localhost:11434/api/tags                     â”‚
â”‚                                                             â”‚
â”‚  è¿è¡Œ Benchmark:                                            â”‚
â”‚  $ node backend/tests/hybridBenchmark.js                    â”‚
â”‚                                                             â”‚
â”‚  æ¨¡å‹ç®¡ç†:                                                  â”‚
â”‚  $ ollama list                  # æŸ¥çœ‹æ¨¡å‹                  â”‚
â”‚  $ ollama pull qwen3:32b        # ä¸‹è½½æ¨¡å‹                  â”‚
â”‚  $ ollama rm qwen3:32b          # åˆ é™¤æ¨¡å‹                  â”‚
â”‚                                                             â”‚
â”‚  Git æ“ä½œ:                                                  â”‚
â”‚  $ git checkout feature/Steven-hybrid-local-llm             â”‚
â”‚  $ git pull origin feature/Steven-hybrid-local-llm          â”‚
â”‚                                                             â”‚
â”‚  åˆ†æ”¯:                                                      â”‚
â”‚  - main                         # ç¨³å®šç‰ˆ                    â”‚
â”‚  - feature/Steven-multi-agent-system  # Cloud Only          â”‚
â”‚  - feature/Steven-hybrid-local-llm    # Hybrid (æœ¬åˆ†æ”¯)     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**Last Updated**: 2025-11-29
**Author**: Claude Code + Steven
**Branch**: `feature/Steven-hybrid-local-llm`
